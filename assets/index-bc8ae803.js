var ct=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var B=(t,e,s)=>(ct(t,e,"read from private field"),s?s.call(t):e.get(t)),J=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},he=(t,e,s,a)=>(ct(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s);var me=(t,e,s)=>(ct(t,e,"access private method"),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const m of o)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function s(o){const m={};return o.integrity&&(m.integrity=o.integrity),o.referrerPolicy&&(m.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?m.credentials="include":o.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(o){if(o.ep)return;o.ep=!0;const m=s(o);fetch(o.href,m)}})();const qr="toSorted"in Array.prototype;qr||(Array.prototype.toSorted=function(t){return[...this].sort(t)});var Fe;class Ur{constructor(){J(this,Fe,"https://22.javascript.pages.academy/kekstagram")}async fetch(e,s="GET",a){const o=await fetch(`${B(this,Fe)}${e}`,{method:s,body:a});if(!o.ok)throw new Error;return o.json()}async getPhotos(){try{return await this.fetch("/data")}catch{throw new Error("Не удалось загрузить данные. Попробуйте обновить страницу")}}async sendPhoto(e){try{return await this.fetch("/","POST",e)}catch{throw new Error("Не удалось отправить форму. Попробуйте ещё раз")}}}Fe=new WeakMap;const Xt=new Ur,Et=t=>t.key==="Escape",Rr=t=>new Set(t).size===t.length,Be=t=>{const e=document.querySelector(`#${t}`);if(e===null)throw new Error(`Template with id ${t} not found`);const s=e.content.firstElementChild;if(s===null)throw new Error(`Template with id ${t} is empty`);return s},le=(t,e,s)=>{s||(s=t.classList[0]);const a=t.querySelector(`.${s}__${e}`);if(a===null)throw new Error(`Element ${e} not found in block ${s}`);return a},Wt=(t,e,s)=>{const a=document.createDocumentFragment();t.forEach(o=>a.append(s(o))),e.append(a)},Ge=(t,e=!0)=>{t.classList.toggle("hidden",!e),document.body.classList.toggle("modal-open",e)},Hr=Be("success"),Nr=Be("error");var Ae,Pe,te,ge,_e,ze,Yt,je,Jt,Ie,Qt,Le,dt,ke,$e;class Zt{constructor(e){J(this,ze);J(this,je);J(this,Ie);J(this,Le);J(this,Ae,void 0);J(this,Pe,!1);J(this,te,null);J(this,ge,null);J(this,_e,null);J(this,ke,e=>{Et(e)&&(e.preventDefault(),e.stopPropagation(),this.close())});J(this,$e,e=>{(e.target===B(this,te)||e.target===B(this,ge))&&this.close()});he(this,Ae,e)}open(e){me(this,ze,Yt).call(this),document.body.appendChild(B(this,te)),me(this,Le,dt).call(this,!0),me(this,Ie,Qt).call(this),e&&me(this,je,Jt).call(this,e)}close(){me(this,Le,dt).call(this,!1),B(this,te).remove(),document.removeEventListener("keydown",B(this,ke),!0)}}Ae=new WeakMap,Pe=new WeakMap,te=new WeakMap,ge=new WeakMap,_e=new WeakMap,ze=new WeakSet,Yt=function(){he(this,te,B(this,Ae).cloneNode(!0)),he(this,Pe,document.body.classList.contains("modal-open")),he(this,ge,le(B(this,te),"button")),he(this,_e,le(B(this,te),"title"))},je=new WeakSet,Jt=function({title:e,onClick:s}){e&&(B(this,_e).textContent=e),s&&B(this,ge).addEventListener("click",s)},Ie=new WeakSet,Qt=function(){B(this,te).addEventListener("click",B(this,$e)),document.addEventListener("keydown",B(this,ke),!0)},Le=new WeakSet,dt=function(e=!1){B(this,Pe)||document.body.classList.toggle("modal-open",e)},ke=new WeakMap,$e=new WeakMap;const Fr=new Zt(Hr),bt=new Zt(Nr),zr=(t,e=500)=>{let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>t(...a),e)}},jr=(t=1,e=100)=>(t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t),Ht=t=>t[jr(0,t.length-1)],Ir=(t,e)=>{const s=[];for(let a=0;a<e;a++){let o=Ht(t);for(;s.includes(o);)o=Ht(t);s.push(o)}return s},$r=Be("comment"),Ue=document.querySelector(".social__comments"),ce=document.querySelector(".social__comment-count"),Re=document.querySelector(".comments-loader"),er=ce==null?void 0:ce.querySelector(".comments-count"),tr=ce==null?void 0:ce.querySelector(".comments-rendered");let we=[];if(!Ue||!ce||!Re||!er||!tr)throw new Error("Critical elements for Comments were not found");const Br=({avatar:t,name:e,message:s})=>{const a=$r.cloneNode(!0),o=le(a,"picture","social");return o.src=t,o.alt=e,le(a,"text","social").textContent=s,a};Re.addEventListener("click",()=>{const t=Ue.childElementCount;let e=t+5;const s=e>=we.length;e=s?we.length:e;const a=we.slice(t,e);Wt(a,Ue,Br),tr.textContent=e.toString(),Re.hidden=s});const Gr=t=>{we=t,er.textContent=t.length.toString(),Re.click()},Kr=()=>{Ue.innerHTML="",we=[]},X=document.querySelector(".big-picture"),ht=X==null?void 0:X.querySelector(".big-picture__img img"),rr=X==null?void 0:X.querySelector(".social__caption"),nr=X==null?void 0:X.querySelector(".likes-count"),sr=X==null?void 0:X.querySelector(".big-picture__cancel");if(!X||!ht||!rr||!nr||!sr)throw new Error("Critical elements for Full Photo were not found");const ir=()=>{Ge(X,!1),document.removeEventListener("keydown",ar),Kr()};sr.addEventListener("click",()=>ir());function ar(t){Et(t)&&ir()}const Xr=({url:t,description:e,likes:s,comments:a})=>{ht.src=t,ht.alt=e,rr.textContent=e,nr.textContent=s.toString(),Gr(a)},Wr=t=>{Ge(X),Xr(t),document.addEventListener("keydown",ar)},Zr=Be("picture"),wt=document.querySelector(".pictures");if(!wt)throw new Error("Pictures wrapper not found");const Yr=({id:t,url:e,description:s,likes:a,comments:o})=>{const m=Zr.cloneNode(!0),v=le(m,"img");return m.dataset.id=t.toString(),v.src=e,v.alt=s,le(m,"likes").textContent=a.toString(),le(m,"comments").textContent=o.length.toString(),m},or=t=>Wt(t,wt,e=>{const s=Yr(e);return s.addEventListener("click",a=>{a.preventDefault(),Wr(e)}),s}),Jr=()=>wt.querySelectorAll(".picture").forEach(t=>t.remove()),yt="img-filters",xt=`${yt}__button`,Nt=`${xt}--active`,pe=document.querySelector(`.${yt}`),mt=pe==null?void 0:pe.querySelectorAll(`.${xt}`);let Me=[];if(!pe||!mt||mt.length<3)throw new Error("No wrapper or buttons");const[Qr,en,tn]=mt;let ye=Qr;const rn=t=>t.classList.contains(xt),nn=()=>ye===en?Ir(Me,10):ye===tn?Me.toSorted((t,e)=>e.comments.length-t.comments.length):Me,sn=zr(()=>{Jr(),or(nn())});pe.addEventListener("click",t=>{const e=t.target;!rn(e)||ye===e||(ye.classList.remove(Nt),e.classList.add(Nt),ye=e,sn())});const an=t=>{Me=t,pe.classList.remove(`${yt}--inactive`),or(t)};Xt.getPhotos().then(an).catch(()=>bt.open({title:"Не удалось загрузить фотографии",onClick:()=>location.reload()}));const x=document.querySelector(".img-upload__form"),Ct=x==null?void 0:x.querySelector(".img-upload__overlay"),ue=x==null?void 0:x.querySelector(".img-upload__preview img"),ve=x==null?void 0:x.querySelector(".img-upload__effect-level"),lr=ve==null?void 0:ve.querySelector(".effect-level__slider"),xe=x==null?void 0:x.querySelector(".effects__list"),pt=x==null?void 0:x.querySelector(".img-upload__submit");if(!x||!Ct||!ue||!lr||!ve||!xe||!pt)throw new Error("Form or it's critical element was not found");const ut=x.querySelector(".scale__control--smaller"),ft=x.querySelector(".scale__control--bigger"),cr=()=>parseInt(x.scale.value,10),ur=t=>{ue.style.transform=`scale(${t/100})`,x.scale.value=`${t}%`};ut==null||ut.addEventListener("click",()=>{const t=cr();t<=25||ur(t-25)});ft==null||ft.addEventListener("click",()=>{const t=cr();t>=100||ur(t+25)});const on=()=>ue.style.removeProperty("transform");var ln=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fr={exports:{}};(function(t,e){(function(s,a){t.exports=a()})(ln,function(){var s={en:{required:"This field is required",email:"This field requires a valid e-mail address",number:"This field requires a number",integer:"This field requires an integer value",url:"This field requires a valid website URL",tel:"This field requires a valid telephone number",maxlength:"This fields length must be < ${1}",minlength:"This fields length must be > ${1}",min:"Minimum value for this field is ${1}",max:"Maximum value for this field is ${1}",pattern:"Please match the requested format",equals:"The two fields do not match",default:"Please enter a correct value"}};function a(w,p){for(;(w=w.parentElement)&&!w.classList.contains(p););return w}function o(w){var p=arguments;return this.replace(/\${([^{}]*)}/g,function(P,h){return p[h]})}function m(w){return w.pristine.self.form.querySelectorAll('input[name="'+w.getAttribute("name")+'"]:checked').length}function v(w,p){for(var P in p)P in w||(w[P]=p[P]);return w}var T={classTo:"form-group",errorClass:"has-danger",successClass:"has-success",errorTextParent:"form-group",errorTextTag:"div",errorTextClass:"text-help"},g="pristine-error",z="input:not([type^=hidden]):not([type^=submit]), select, textarea",W=["required","min","max","minlength","maxlength","pattern"],U=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,A=/-message(?:-([a-z]{2}(?:_[A-Z]{2})?))?/,H="en",V={},L=function(p,P){P.name=p,P.priority===void 0&&(P.priority=1),V[p]=P};L("text",{fn:function(p){return!0},priority:0}),L("required",{fn:function(p){return this.type==="radio"||this.type==="checkbox"?m(this):p!==void 0&&p.trim()!==""},priority:99,halt:!0}),L("email",{fn:function(p){return!p||U.test(p)}}),L("number",{fn:function(p){return!p||!isNaN(parseFloat(p))},priority:2}),L("integer",{fn:function(p){return!p||/^\d+$/.test(p)}}),L("minlength",{fn:function(p,P){return!p||p.length>=parseInt(P)}}),L("maxlength",{fn:function(p,P){return!p||p.length<=parseInt(P)}}),L("min",{fn:function(p,P){return!p||(this.type==="checkbox"?m(this)>=parseInt(P):parseFloat(p)>=parseFloat(P))}}),L("max",{fn:function(p,P){return!p||(this.type==="checkbox"?m(this)<=parseInt(P):parseFloat(p)<=parseFloat(P))}}),L("pattern",{fn:function(p,P){var h=P.match(new RegExp("^/(.*?)/([gimy]*)$"));return!p||new RegExp(h[1],h[2]).test(p)}}),L("equals",{fn:function(p,P){var h=document.querySelector(P);return h&&(!p&&!h.value||h.value===p)}});function re(w,p,P){var h=this;fe(w,p,P);function fe(f,S,C){f.setAttribute("novalidate","true"),h.form=f,h.config=v(S||{},T),h.live=C!==!1,h.fields=Array.from(f.querySelectorAll(z)).map(function(b){var y=[],k={},Y={};return[].forEach.call(b.attributes,function(I){if(/^data-pristine-/.test(I.name)){var Q=I.name.substr(14),de=Q.match(A);if(de!==null){var Ee=de[1]===void 0?"en":de[1];Y.hasOwnProperty(Ee)||(Y[Ee]={}),Y[Ee][Q.slice(0,Q.length-de[0].length)]=I.value;return}Q==="type"&&(Q=I.value),Z(y,k,Q,I.value)}else~W.indexOf(I.name)?Z(y,k,I.name,I.value):I.name==="type"&&Z(y,k,I.value)}),y.sort(function(I,Q){return Q.priority-I.priority}),h.live&&b.addEventListener(~["radio","checkbox"].indexOf(b.getAttribute("type"))?"change":"input",function(I){h.validate(I.target)}.bind(h)),b.pristine={input:b,validators:y,params:k,messages:Y,self:h}}.bind(h))}function Z(f,S,C,b){var y=V[C];if(y&&(f.push(y),b)){var k=C==="pattern"?[b]:b.split(",");k.unshift(null),S[C]=k}}h.validate=function(f,S){S=f&&S===!0||f===!0;var C=h.fields;f!==!0&&f!==!1&&(f instanceof HTMLElement?C=[f.pristine]:(f instanceof NodeList||f instanceof(window.$||Array)||f instanceof Array)&&(C=Array.from(f).map(function(Y){return Y.pristine})));for(var b=!0,y=0;C[y];y++){var k=C[y];We(k)?!S&&Ye(k):(b=!1,!S&&De(k))}return b},h.getErrors=function(f){if(!f){for(var S=[],C=0;C<h.fields.length;C++){var b=h.fields[C];b.errors.length&&S.push({input:b.input,errors:b.errors})}return S}return f.tagName&&f.tagName.toLowerCase()==="select"?f.pristine.errors:f.length?f[0].pristine.errors:f.pristine.errors};function We(f){for(var S=[],C=!0,b=0;f.validators[b];b++){var y=f.validators[b],k=f.params[y.name]?f.params[y.name]:[];if(k[0]=f.input.value,!y.fn.apply(f.input,k)&&(C=!1,typeof y.msg=="function"?S.push(y.msg(f.input.value,k)):typeof y.msg=="string"?S.push(o.apply(y.msg,k)):y.msg===Object(y.msg)&&y.msg[H]?S.push(o.apply(y.msg[H],k)):f.messages[H]&&f.messages[H][y.name]?S.push(o.apply(f.messages[H][y.name],k)):s[H]&&s[H][y.name]?S.push(o.apply(s[H][y.name],k)):S.push(o.apply(s[H].default,k)),y.halt===!0))break}return f.errors=S,C}h.addValidator=function(f,S,C,b,y){f instanceof HTMLElement?(f.pristine.validators.push({fn:S,msg:C,priority:b,halt:y}),f.pristine.validators.sort(function(k,Y){return Y.priority-k.priority})):console.warn("The parameter elem must be a dom element")};function Se(f){if(f.errorElements)return f.errorElements;var S=a(f.input,h.config.classTo),C=null,b=null;return h.config.classTo===h.config.errorTextParent?C=S:C=S.querySelector("."+h.config.errorTextParent),C&&(b=C.querySelector("."+g),b||(b=document.createElement(h.config.errorTextTag),b.className=g+" "+h.config.errorTextClass,C.appendChild(b),b.pristineDisplay=b.style.display)),f.errorElements=[S,b]}function De(f){var S=Se(f),C=S[0],b=S[1],y=f.input,k=y.id||Math.floor(new Date().valueOf()*Math.random()),Y="error-"+k;C&&(C.classList.remove(h.config.successClass),C.classList.add(h.config.errorClass),y.setAttribute("aria-describedby",Y),y.setAttribute("aria-invalid","true")),b&&(b.setAttribute("id",Y),b.setAttribute("role","alert"),b.innerHTML=f.errors.join("<br/>"),b.style.display=b.pristineDisplay||"")}h.addError=function(f,S){f=f.length?f[0]:f,f.pristine.errors.push(S),De(f.pristine)};function Ze(f){var S=Se(f),C=S[0],b=S[1],y=f.input;return C&&(C.classList.remove(h.config.errorClass),C.classList.remove(h.config.successClass),y.removeAttribute("aria-describedby"),y.removeAttribute("aria-invalid")),b&&(b.removeAttribute("id"),b.removeAttribute("role"),b.innerHTML="",b.style.display="none"),S}function Ye(f){var S=Ze(f)[0];S&&S.classList.add(h.config.successClass)}return h.reset=function(){for(var f=0;h.fields[f];f++)h.fields[f].errorElements=null;Array.from(h.form.querySelectorAll("."+g)).map(function(S){S.parentNode.removeChild(S)}),Array.from(h.form.querySelectorAll("."+h.config.classTo)).map(function(S){S.classList.remove(h.config.successClass),S.classList.remove(h.config.errorClass)})},h.destroy=function(){h.reset(),h.fields.forEach(function(f){delete f.input.pristine}),h.fields=[]},h.setGlobalConfig=function(f){T=f},h}return re.addValidator=function(w,p,P,h,fe){L(w,{fn:p,msg:P,priority:h,halt:fe})},re.addMessages=function(w,p){var P=s.hasOwnProperty(w)?s[w]:s[w]={};Object.keys(p).forEach(function(h,fe){P[h]=p[h]})},re.setLocale=function(w){H=w},re})})(fr);var un=fr.exports;const fn=cn(un),dn=/^#[a-zа-яё0-9]{1,19}$/,Ke=new fn(x,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper"});let oe="";const hn=t=>{if(!t.length)return!0;const e=t.trim().toLocaleLowerCase().split(/\s*(?=#)/);return e.length>5?(oe="Нельзя указать больше пяти хэш-тегов",!1):Rr(e)?e.every(s=>s[0]!=="#"?(oe="Хэштег должен начинаться с #",!1):s.length>20?(oe="Максимальная длина одного хэш-тега 20 символов, включая решётку",!1):s==="#"?(oe="Хеш-тег не может состоять только из одной решётки",!1):dn.test(s)?!0:(oe="Строка после решётки должна состоять из букв и чисел и не может содержать пробелы спецсимволы и т п символы пунктуации тире дефис запятая и т п эмодзи и т д",!1)):(oe="Один и тот же хэш-тег не может быть использован дважды",!1)};Ke.addValidator(x.hashtags,hn,()=>oe);Ke.addValidator(x.description,t=>t.length<=140,"Максимальная длина комментария 140 символов");const mn=()=>Ke.validate(),pn=()=>Ke.reset();var se;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(se||(se={}));var K;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(K||(K={}));function vn(t){return He(t)&&typeof t.from=="function"}function He(t){return typeof t=="object"&&typeof t.to=="function"}function Ft(t){t.parentElement.removeChild(t)}function vt(t){return t!=null}function zt(t){t.preventDefault()}function gn(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Sn(t,e){return Math.round(t/e)*e}function En(t,e){var s=t.getBoundingClientRect(),a=t.ownerDocument,o=a.documentElement,m=dr(a);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(m.x=0),e?s.top+m.y-o.clientTop:s.left+m.x-o.clientLeft}function ee(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function jt(t,e,s){s>0&&(G(t,e),setTimeout(function(){qe(t,e)},s))}function It(t){return Math.max(Math.min(t,100),0)}function Xe(t){return Array.isArray(t)?t:[t]}function bn(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function G(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function qe(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function wn(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function dr(t){var e=window.pageXOffset!==void 0,s=(t.compatMode||"")==="CSS1Compat",a=e?window.pageXOffset:s?t.documentElement.scrollLeft:t.body.scrollLeft,o=e?window.pageYOffset:s?t.documentElement.scrollTop:t.body.scrollTop;return{x:a,y:o}}function yn(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function xn(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function Cn(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function At(t,e){return 100/(e-t)}function gt(t,e,s){return e*100/(t[s+1]-t[s])}function An(t,e){return gt(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function Pn(t,e){return e*(t[1]-t[0])/100+t[0]}function Ce(t,e){for(var s=1;t>=e[s];)s+=1;return s}function _n(t,e,s){if(s>=t.slice(-1)[0])return 100;var a=Ce(s,t),o=t[a-1],m=t[a],v=e[a-1],T=e[a];return v+An([o,m],s)/At(v,T)}function Ln(t,e,s){if(s>=100)return t.slice(-1)[0];var a=Ce(s,e),o=t[a-1],m=t[a],v=e[a-1],T=e[a];return Pn([o,m],(s-v)*At(v,T))}function kn(t,e,s,a){if(a===100)return a;var o=Ce(a,t),m=t[o-1],v=t[o];return s?a-m>(v-m)/2?v:m:e[o-1]?t[o-1]+Sn(a-t[o-1],e[o-1]):a}var hr=function(){function t(e,s,a){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[a||!1],this.xNumSteps=[!1],this.snap=s;var o,m=[];for(Object.keys(e).forEach(function(v){m.push([Xe(e[v]),v])}),m.sort(function(v,T){return v[0][0]-T[0][0]}),o=0;o<m.length;o++)this.handleEntryPoint(m[o][1],m[o][0]);for(this.xNumSteps=this.xSteps.slice(0),o=0;o<this.xNumSteps.length;o++)this.handleStepPoint(o,this.xNumSteps[o])}return t.prototype.getDistance=function(e){for(var s=[],a=0;a<this.xNumSteps.length-1;a++)s[a]=gt(this.xVal,e,a);return s},t.prototype.getAbsoluteDistance=function(e,s,a){var o=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[o+1];)o++;else e===this.xPct[this.xPct.length-1]&&(o=this.xPct.length-2);!a&&e===this.xPct[o+1]&&o++,s===null&&(s=[]);var m,v=1,T=s[o],g=0,z=0,W=0,U=0;for(a?m=(e-this.xPct[o])/(this.xPct[o+1]-this.xPct[o]):m=(this.xPct[o+1]-e)/(this.xPct[o+1]-this.xPct[o]);T>0;)g=this.xPct[o+1+U]-this.xPct[o+U],s[o+U]*v+100-m*100>100?(z=g*m,v=(T-100*m)/s[o+U],m=1):(z=s[o+U]*g/100*v,v=0),a?(W=W-z,this.xPct.length+U>=1&&U--):(W=W+z,this.xPct.length-U>=1&&U++),T=s[o+U]*v;return e+W},t.prototype.toStepping=function(e){return e=_n(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return Ln(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=kn(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,s,a){var o=Ce(e,this.xPct);return(e===100||s&&e===this.xPct[o-1])&&(o=Math.max(o-1,1)),(this.xVal[o]-this.xVal[o-1])/a},t.prototype.getNearbySteps=function(e){var s=Ce(e,this.xPct);return{stepBefore:{startValue:this.xVal[s-2],step:this.xNumSteps[s-2],highestStep:this.xHighestCompleteStep[s-2]},thisStep:{startValue:this.xVal[s-1],step:this.xNumSteps[s-1],highestStep:this.xHighestCompleteStep[s-1]},stepAfter:{startValue:this.xVal[s],step:this.xNumSteps[s],highestStep:this.xHighestCompleteStep[s]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(bn);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,s){var a;if(e==="min"?a=0:e==="max"?a=100:a=parseFloat(e),!ee(a)||!ee(s[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(a),this.xVal.push(s[0]);var o=Number(s[1]);a?this.xSteps.push(isNaN(o)?!1:o):isNaN(o)||(this.xSteps[0]=o),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,s){if(s){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=gt([this.xVal[e],this.xVal[e+1]],s,0)/At(this.xPct[e],this.xPct[e+1]);var a=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],o=Math.ceil(Number(a.toFixed(3))-1),m=this.xVal[e]+this.xNumSteps[e]*o;this.xHighestCompleteStep[e]=m}},t}(),$t={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},mr={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},ne={tooltips:".__tooltips",aria:".__aria"};function Dn(t,e){if(!ee(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function Tn(t,e){if(!ee(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function Vn(t,e){if(!ee(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function On(t,e){if(!ee(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function Mn(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new hr(e,t.snap||!1,t.singleStep)}function qn(t,e){if(e=Xe(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function Un(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function Rn(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Hn(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function Nn(t,e){var s=[!1],a;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(a=1;a<t.handles;a++)s.push(e);s.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");s=e}t.connect=s}function Fn(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function pr(t,e){if(!ee(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function zn(t,e){if(!ee(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function jn(t,e){var s;if(!ee(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||ee(e[0])||ee(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],s=0;s<t.spectrum.xNumSteps.length-1;s++)if(t.padding[0][s]<0||t.padding[1][s]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var a=e[0]+e[1],o=t.spectrum.xVal[0],m=t.spectrum.xVal[t.spectrum.xVal.length-1];if(a/(m-o)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function In(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function $n(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var s=e.indexOf("tap")>=0,a=e.indexOf("drag")>=0,o=e.indexOf("fixed")>=0,m=e.indexOf("snap")>=0,v=e.indexOf("hover")>=0,T=e.indexOf("unconstrained")>=0,g=e.indexOf("drag-all")>=0,z=e.indexOf("smooth-steps")>=0;if(o){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");pr(t,t.start[1]-t.start[0])}if(T&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:s||m,drag:a,dragAll:g,smoothSteps:z,fixed:o,snap:m,hover:v,unconstrained:T}}function Bn(t,e){if(e!==!1)if(e===!0||He(e)){t.tooltips=[];for(var s=0;s<t.handles;s++)t.tooltips.push(e)}else{if(e=Xe(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(a){if(typeof a!="boolean"&&!He(a))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function Gn(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Kn(t,e){if(!He(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Xn(t,e){if(!vn(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Wn(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Zn(t,e){t.documentElement=e}function Yn(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function Jn(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(s){t.cssClasses[s]=t.cssPrefix+e[s]})):t.cssClasses=e}function vr(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:$t,format:$t},s={step:{r:!1,t:Dn},keyboardPageMultiplier:{r:!1,t:Tn},keyboardMultiplier:{r:!1,t:Vn},keyboardDefaultStep:{r:!1,t:On},start:{r:!0,t:qn},connect:{r:!0,t:Nn},direction:{r:!0,t:In},snap:{r:!1,t:Un},animate:{r:!1,t:Rn},animationDuration:{r:!1,t:Hn},range:{r:!0,t:Mn},orientation:{r:!1,t:Fn},margin:{r:!1,t:pr},limit:{r:!1,t:zn},padding:{r:!1,t:jn},behaviour:{r:!0,t:$n},ariaFormat:{r:!1,t:Kn},format:{r:!1,t:Xn},tooltips:{r:!1,t:Bn},keyboardSupport:{r:!0,t:Wn},documentElement:{r:!1,t:Zn},cssPrefix:{r:!0,t:Yn},cssClasses:{r:!0,t:Jn},handleAttributes:{r:!1,t:Gn}},a={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:mr,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(s).forEach(function(g){if(!vt(t[g])&&a[g]===void 0){if(s[g].r)throw new Error("noUiSlider: '"+g+"' is required.");return}s[g].t(e,vt(t[g])?t[g]:a[g])}),e.pips=t.pips;var o=document.createElement("div"),m=o.style.msTransform!==void 0,v=o.style.transform!==void 0;e.transformRule=v?"transform":m?"msTransform":"webkitTransform";var T=[["left","top"],["right","bottom"]];return e.style=T[e.dir][e.ort],e}function Qn(t,e,s){var a=yn(),o=Cn(),m=o&&xn(),v=t,T,g,z,W,U,A=e.spectrum,H=[],V=[],L=[],re=0,w={},p=t.ownerDocument,P=e.documentElement||p.documentElement,h=p.body,fe=p.dir==="rtl"||e.ort===1?0:100;function Z(r,n){var i=p.createElement("div");return n&&G(i,n),r.appendChild(i),i}function We(r,n){var i=Z(r,e.cssClasses.origin),l=Z(i,e.cssClasses.handle);if(Z(l,e.cssClasses.touchArea),l.setAttribute("data-handle",String(n)),e.keyboardSupport&&(l.setAttribute("tabindex","0"),l.addEventListener("keydown",function(c){return Ar(c,n)})),e.handleAttributes!==void 0){var u=e.handleAttributes[n];Object.keys(u).forEach(function(c){l.setAttribute(c,u[c])})}return l.setAttribute("role","slider"),l.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),n===0?G(l,e.cssClasses.handleLower):n===e.handles-1&&G(l,e.cssClasses.handleUpper),i.handle=l,i}function Se(r,n){return n?Z(r,e.cssClasses.connect):!1}function De(r,n){var i=Z(n,e.cssClasses.connects);g=[],z=[],z.push(Se(i,r[0]));for(var l=0;l<e.handles;l++)g.push(We(n,l)),L[l]=l,z.push(Se(i,r[l+1]))}function Ze(r){G(r,e.cssClasses.target),e.dir===0?G(r,e.cssClasses.ltr):G(r,e.cssClasses.rtl),e.ort===0?G(r,e.cssClasses.horizontal):G(r,e.cssClasses.vertical);var n=getComputedStyle(r).direction;return n==="rtl"?G(r,e.cssClasses.textDirectionRtl):G(r,e.cssClasses.textDirectionLtr),Z(r,e.cssClasses.base)}function Ye(r,n){return!e.tooltips||!e.tooltips[n]?!1:Z(r.firstChild,e.cssClasses.tooltip)}function f(){return v.hasAttribute("disabled")}function S(r){var n=g[r];return n.hasAttribute("disabled")}function C(r){r!=null?(g[r].setAttribute("disabled",""),g[r].handle.removeAttribute("tabindex")):(v.setAttribute("disabled",""),g.forEach(function(n){n.handle.removeAttribute("tabindex")}))}function b(r){r!=null?(g[r].removeAttribute("disabled"),g[r].handle.setAttribute("tabindex","0")):(v.removeAttribute("disabled"),g.forEach(function(n){n.removeAttribute("disabled"),n.handle.setAttribute("tabindex","0")}))}function y(){U&&(be("update"+ne.tooltips),U.forEach(function(r){r&&Ft(r)}),U=null)}function k(){y(),U=g.map(Ye),rt("update"+ne.tooltips,function(r,n,i){if(!(!U||!e.tooltips)&&U[n]!==!1){var l=r[n];e.tooltips[n]!==!0&&(l=e.tooltips[n].to(i[n])),U[n].innerHTML=l}})}function Y(){be("update"+ne.aria),rt("update"+ne.aria,function(r,n,i,l,u){L.forEach(function(c){var E=g[c],d=Te(V,c,0,!0,!0,!0),O=Te(V,c,100,!0,!0,!0),D=u[c],M=String(e.ariaFormat.to(i[c]));d=A.fromStepping(d).toFixed(1),O=A.fromStepping(O).toFixed(1),D=A.fromStepping(D).toFixed(1),E.children[0].setAttribute("aria-valuemin",d),E.children[0].setAttribute("aria-valuemax",O),E.children[0].setAttribute("aria-valuenow",D),E.children[0].setAttribute("aria-valuetext",M)})})}function I(r){if(r.mode===se.Range||r.mode===se.Steps)return A.xVal;if(r.mode===se.Count){if(r.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var n=r.values-1,i=100/n,l=[];n--;)l[n]=n*i;return l.push(100),Q(l,r.stepped)}return r.mode===se.Positions?Q(r.values,r.stepped):r.mode===se.Values?r.stepped?r.values.map(function(u){return A.fromStepping(A.getStep(A.toStepping(u)))}):r.values:[]}function Q(r,n){return r.map(function(i){return A.fromStepping(n?A.getStep(i):i)})}function de(r){function n(D,M){return Number((D+M).toFixed(7))}var i=I(r),l={},u=A.xVal[0],c=A.xVal[A.xVal.length-1],E=!1,d=!1,O=0;return i=gn(i.slice().sort(function(D,M){return D-M})),i[0]!==u&&(i.unshift(u),E=!0),i[i.length-1]!==c&&(i.push(c),d=!0),i.forEach(function(D,M){var q,_,N,$=D,F=i[M+1],j,it,at,ot,qt,lt,Ut,Rt=r.mode===se.Steps;for(Rt&&(q=A.xNumSteps[M]),q||(q=F-$),F===void 0&&(F=$),q=Math.max(q,1e-7),_=$;_<=F;_=n(_,q)){for(j=A.toStepping(_),it=j-O,qt=it/(r.density||1),lt=Math.round(qt),Ut=it/lt,N=1;N<=lt;N+=1)at=O+N*Ut,l[at.toFixed(5)]=[A.fromStepping(at),0];ot=i.indexOf(_)>-1?K.LargeValue:Rt?K.SmallValue:K.NoValue,!M&&E&&_!==F&&(ot=0),_===F&&d||(l[j.toFixed(5)]=[_,ot]),O=j}}),l}function Ee(r,n,i){var l,u,c=p.createElement("div"),E=(l={},l[K.None]="",l[K.NoValue]=e.cssClasses.valueNormal,l[K.LargeValue]=e.cssClasses.valueLarge,l[K.SmallValue]=e.cssClasses.valueSub,l),d=(u={},u[K.None]="",u[K.NoValue]=e.cssClasses.markerNormal,u[K.LargeValue]=e.cssClasses.markerLarge,u[K.SmallValue]=e.cssClasses.markerSub,u),O=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],D=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];G(c,e.cssClasses.pips),G(c,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function M(_,N){var $=N===e.cssClasses.value,F=$?O:D,j=$?E:d;return N+" "+F[e.ort]+" "+j[_]}function q(_,N,$){if($=n?n(N,$):$,$!==K.None){var F=Z(c,!1);F.className=M($,e.cssClasses.marker),F.style[e.style]=_+"%",$>K.NoValue&&(F=Z(c,!1),F.className=M($,e.cssClasses.value),F.setAttribute("data-value",String(N)),F.style[e.style]=_+"%",F.innerHTML=String(i.to(N)))}}return Object.keys(r).forEach(function(_){q(_,r[_][0],r[_][1])}),c}function Je(){W&&(Ft(W),W=null)}function Qe(r){Je();var n=de(r),i=r.filter,l=r.format||{to:function(u){return String(Math.round(u))}};return W=v.appendChild(Ee(n,i,l)),W}function _t(){var r=T.getBoundingClientRect(),n="offset"+["Width","Height"][e.ort];return e.ort===0?r.width||T[n]:r.height||T[n]}function ie(r,n,i,l){var u=function(E){var d=Er(E,l.pageOffset,l.target||n);if(!d||f()&&!l.doNotReject||wn(v,e.cssClasses.tap)&&!l.doNotReject||r===a.start&&d.buttons!==void 0&&d.buttons>1||l.hover&&d.buttons)return!1;m||d.preventDefault(),d.calcPoint=d.points[e.ort],i(d,l)},c=[];return r.split(" ").forEach(function(E){n.addEventListener(E,u,m?{passive:!0}:!1),c.push([E,u])}),c}function Er(r,n,i){var l=r.type.indexOf("touch")===0,u=r.type.indexOf("mouse")===0,c=r.type.indexOf("pointer")===0,E=0,d=0;if(r.type.indexOf("MSPointer")===0&&(c=!0),r.type==="mousedown"&&!r.buttons&&!r.touches)return!1;if(l){var O=function(q){var _=q.target;return _===i||i.contains(_)||r.composed&&r.composedPath().shift()===i};if(r.type==="touchstart"){var D=Array.prototype.filter.call(r.touches,O);if(D.length>1)return!1;E=D[0].pageX,d=D[0].pageY}else{var M=Array.prototype.find.call(r.changedTouches,O);if(!M)return!1;E=M.pageX,d=M.pageY}}return n=n||dr(p),(u||c)&&(E=r.clientX+n.x,d=r.clientY+n.y),r.pageOffset=n,r.points=[E,d],r.cursor=u||c,r}function Lt(r){var n=r-En(T,e.ort),i=n*100/_t();return i=It(i),e.dir?100-i:i}function br(r){var n=100,i=!1;return g.forEach(function(l,u){if(!S(u)){var c=V[u],E=Math.abs(c-r),d=E===100&&n===100,O=E<n,D=E<=n&&r>c;(O||D||d)&&(i=u,n=E)}}),i}function wr(r,n){r.type==="mouseout"&&r.target.nodeName==="HTML"&&r.relatedTarget===null&&et(r,n)}function yr(r,n){if(navigator.appVersion.indexOf("MSIE 9")===-1&&r.buttons===0&&n.buttonsProperty!==0)return et(r,n);var i=(e.dir?-1:1)*(r.calcPoint-n.startCalcPoint),l=i*100/n.baseSize;kt(i>0,l,n.locations,n.handleNumbers,n.connect)}function et(r,n){n.handle&&(qe(n.handle,e.cssClasses.active),re-=1),n.listeners.forEach(function(i){P.removeEventListener(i[0],i[1])}),re===0&&(qe(v,e.cssClasses.drag),st(),r.cursor&&(h.style.cursor="",h.removeEventListener("selectstart",zt))),e.events.smoothSteps&&(n.handleNumbers.forEach(function(i){ae(i,V[i],!0,!0,!1,!1)}),n.handleNumbers.forEach(function(i){R("update",i)})),n.handleNumbers.forEach(function(i){R("change",i),R("set",i),R("end",i)})}function tt(r,n){if(!n.handleNumbers.some(S)){var i;if(n.handleNumbers.length===1){var l=g[n.handleNumbers[0]];i=l.children[0],re+=1,G(i,e.cssClasses.active)}r.stopPropagation();var u=[],c=ie(a.move,P,yr,{target:r.target,handle:i,connect:n.connect,listeners:u,startCalcPoint:r.calcPoint,baseSize:_t(),pageOffset:r.pageOffset,handleNumbers:n.handleNumbers,buttonsProperty:r.buttons,locations:V.slice()}),E=ie(a.end,P,et,{target:r.target,handle:i,listeners:u,doNotReject:!0,handleNumbers:n.handleNumbers}),d=ie("mouseout",P,wr,{target:r.target,handle:i,listeners:u,doNotReject:!0,handleNumbers:n.handleNumbers});u.push.apply(u,c.concat(E,d)),r.cursor&&(h.style.cursor=getComputedStyle(r.target).cursor,g.length>1&&G(v,e.cssClasses.drag),h.addEventListener("selectstart",zt,!1)),n.handleNumbers.forEach(function(O){R("start",O)})}}function xr(r){r.stopPropagation();var n=Lt(r.calcPoint),i=br(n);i!==!1&&(e.events.snap||jt(v,e.cssClasses.tap,e.animationDuration),ae(i,n,!0,!0),st(),R("slide",i,!0),R("update",i,!0),e.events.snap?tt(r,{handleNumbers:[i]}):(R("change",i,!0),R("set",i,!0)))}function Cr(r){var n=Lt(r.calcPoint),i=A.getStep(n),l=A.fromStepping(i);Object.keys(w).forEach(function(u){u.split(".")[0]==="hover"&&w[u].forEach(function(c){c.call(Oe,l)})})}function Ar(r,n){if(f()||S(n))return!1;var i=["Left","Right"],l=["Down","Up"],u=["PageDown","PageUp"],c=["Home","End"];e.dir&&!e.ort?i.reverse():e.ort&&!e.dir&&(l.reverse(),u.reverse());var E=r.key.replace("Arrow",""),d=E===u[0],O=E===u[1],D=E===l[0]||E===i[0]||d,M=E===l[1]||E===i[1]||O,q=E===c[0],_=E===c[1];if(!D&&!M&&!q&&!_)return!0;r.preventDefault();var N;if(M||D){var $=D?0:1,F=Mt(n),j=F[$];if(j===null)return!1;j===!1&&(j=A.getDefaultStep(V[n],D,e.keyboardDefaultStep)),O||d?j*=e.keyboardPageMultiplier:j*=e.keyboardMultiplier,j=Math.max(j,1e-7),j=(D?-1:1)*j,N=H[n]+j}else _?N=e.spectrum.xVal[e.spectrum.xVal.length-1]:N=e.spectrum.xVal[0];return ae(n,A.toStepping(N),!0,!0),R("slide",n),R("update",n),R("change",n),R("set",n),!1}function Pr(r){r.fixed||g.forEach(function(n,i){ie(a.start,n.children[0],tt,{handleNumbers:[i]})}),r.tap&&ie(a.start,T,xr,{}),r.hover&&ie(a.move,T,Cr,{hover:!0}),r.drag&&z.forEach(function(n,i){if(!(n===!1||i===0||i===z.length-1)){var l=g[i-1],u=g[i],c=[n],E=[l,u],d=[i-1,i];G(n,e.cssClasses.draggable),r.fixed&&(c.push(l.children[0]),c.push(u.children[0])),r.dragAll&&(E=g,d=L),c.forEach(function(O){ie(a.start,O,tt,{handles:E,handleNumbers:d,connect:n})})}})}function rt(r,n){w[r]=w[r]||[],w[r].push(n),r.split(".")[0]==="update"&&g.forEach(function(i,l){R("update",l)})}function _r(r){return r===ne.aria||r===ne.tooltips}function be(r){var n=r&&r.split(".")[0],i=n?r.substring(n.length):r;Object.keys(w).forEach(function(l){var u=l.split(".")[0],c=l.substring(u.length);(!n||n===u)&&(!i||i===c)&&(!_r(c)||i===c)&&delete w[l]})}function R(r,n,i){Object.keys(w).forEach(function(l){var u=l.split(".")[0];r===u&&w[l].forEach(function(c){c.call(Oe,H.map(e.format.to),n,H.slice(),i||!1,V.slice(),Oe)})})}function Te(r,n,i,l,u,c,E){var d;return g.length>1&&!e.events.unconstrained&&(l&&n>0&&(d=A.getAbsoluteDistance(r[n-1],e.margin,!1),i=Math.max(i,d)),u&&n<g.length-1&&(d=A.getAbsoluteDistance(r[n+1],e.margin,!0),i=Math.min(i,d))),g.length>1&&e.limit&&(l&&n>0&&(d=A.getAbsoluteDistance(r[n-1],e.limit,!1),i=Math.min(i,d)),u&&n<g.length-1&&(d=A.getAbsoluteDistance(r[n+1],e.limit,!0),i=Math.max(i,d))),e.padding&&(n===0&&(d=A.getAbsoluteDistance(0,e.padding[0],!1),i=Math.max(i,d)),n===g.length-1&&(d=A.getAbsoluteDistance(100,e.padding[1],!0),i=Math.min(i,d))),E||(i=A.getStep(i)),i=It(i),i===r[n]&&!c?!1:i}function nt(r,n){var i=e.ort;return(i?n:r)+", "+(i?r:n)}function kt(r,n,i,l,u){var c=i.slice(),E=l[0],d=e.events.smoothSteps,O=[!r,r],D=[r,!r];l=l.slice(),r&&l.reverse(),l.length>1?l.forEach(function(q,_){var N=Te(c,q,c[q]+n,O[_],D[_],!1,d);N===!1?n=0:(n=N-c[q],c[q]=N)}):O=D=[!0];var M=!1;l.forEach(function(q,_){M=ae(q,i[q]+n,O[_],D[_],!1,d)||M}),M&&(l.forEach(function(q){R("update",q),R("slide",q)}),u!=null&&R("drag",E))}function Dt(r,n){return e.dir?100-r-n:r}function Lr(r,n){V[r]=n,H[r]=A.fromStepping(n);var i=Dt(n,0)-fe,l="translate("+nt(i+"%","0")+")";g[r].style[e.transformRule]=l,Tt(r),Tt(r+1)}function st(){L.forEach(function(r){var n=V[r]>50?-1:1,i=3+(g.length+n*r);g[r].style.zIndex=String(i)})}function ae(r,n,i,l,u,c){return u||(n=Te(V,r,n,i,l,!1,c)),n===!1?!1:(Lr(r,n),!0)}function Tt(r){if(z[r]){var n=0,i=100;r!==0&&(n=V[r-1]),r!==z.length-1&&(i=V[r]);var l=i-n,u="translate("+nt(Dt(n,l)+"%","0")+")",c="scale("+nt(l/100,"1")+")";z[r].style[e.transformRule]=u+" "+c}}function Vt(r,n){return r===null||r===!1||r===void 0||(typeof r=="number"&&(r=String(r)),r=e.format.from(r),r!==!1&&(r=A.toStepping(r)),r===!1||isNaN(r))?V[n]:r}function Ve(r,n,i){var l=Xe(r),u=V[0]===void 0;n=n===void 0?!0:n,e.animate&&!u&&jt(v,e.cssClasses.tap,e.animationDuration),L.forEach(function(d){ae(d,Vt(l[d],d),!0,!1,i)});var c=L.length===1?0:1;if(u&&A.hasNoSize()&&(i=!0,V[0]=0,L.length>1)){var E=100/(L.length-1);L.forEach(function(d){V[d]=d*E})}for(;c<L.length;++c)L.forEach(function(d){ae(d,V[d],!0,!0,i)});st(),L.forEach(function(d){R("update",d),l[d]!==null&&n&&R("set",d)})}function kr(r){Ve(e.start,r)}function Dr(r,n,i,l){if(r=Number(r),!(r>=0&&r<L.length))throw new Error("noUiSlider: invalid handle number, got: "+r);ae(r,Vt(n,r),!0,!0,l),R("update",r),i&&R("set",r)}function Ot(r){if(r===void 0&&(r=!1),r)return H.length===1?H[0]:H.slice(0);var n=H.map(e.format.to);return n.length===1?n[0]:n}function Tr(){for(be(ne.aria),be(ne.tooltips),Object.keys(e.cssClasses).forEach(function(r){qe(v,e.cssClasses[r])});v.firstChild;)v.removeChild(v.firstChild);delete v.noUiSlider}function Mt(r){var n=V[r],i=A.getNearbySteps(n),l=H[r],u=i.thisStep.step,c=null;if(e.snap)return[l-i.stepBefore.startValue||null,i.stepAfter.startValue-l||null];u!==!1&&l+u>i.stepAfter.startValue&&(u=i.stepAfter.startValue-l),l>i.thisStep.startValue?c=i.thisStep.step:i.stepBefore.step===!1?c=!1:c=l-i.stepBefore.highestStep,n===100?u=null:n===0&&(c=null);var E=A.countStepDecimals();return u!==null&&u!==!1&&(u=Number(u.toFixed(E))),c!==null&&c!==!1&&(c=Number(c.toFixed(E))),[c,u]}function Vr(){return L.map(Mt)}function Or(r,n){var i=Ot(),l=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];l.forEach(function(c){r[c]!==void 0&&(s[c]=r[c])});var u=vr(s);l.forEach(function(c){r[c]!==void 0&&(e[c]=u[c])}),A=u.spectrum,e.margin=u.margin,e.limit=u.limit,e.padding=u.padding,e.pips?Qe(e.pips):Je(),e.tooltips?k():y(),V=[],Ve(vt(r.start)?r.start:i,n)}function Mr(){T=Ze(v),De(e.connect,T),Pr(e.events),Ve(e.start),e.pips&&Qe(e.pips),e.tooltips&&k(),Y()}Mr();var Oe={destroy:Tr,steps:Vr,on:rt,off:be,get:Ot,set:Ve,setHandle:Dr,reset:kr,disable:C,enable:b,__moveHandles:function(r,n,i){kt(r,n,V,i)},options:s,updateOptions:Or,target:v,removePips:Je,removeTooltips:y,getPositions:function(){return V.slice()},getTooltips:function(){return U},getOrigins:function(){return g},pips:Qe};return Oe}function es(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var s=vr(e),a=Qn(t,s,e);return t.noUiSlider=a,a}const ts={__spectrum:hr,cssClasses:mr,create:es};const Bt=Ne(0,1,.1),Gt=Ne(),Pt={none:{slider:Gt},chrome:{slider:Bt,filter:t=>`grayscale(${t})`},sepia:{slider:Bt,filter:t=>`sepia(${t})`},marvin:{slider:Gt,filter:t=>`invert(${t}%)`},phobos:{slider:Ne(0,3,.1),filter:t=>`blur(${t}px)`},heat:{slider:Ne(1,3,.1),filter:t=>`brightness(${t})`}};function Ne(t=0,e=100,s=1,a=e){return{range:{min:t,max:e},start:a,step:s}}const rs=new Event("change"),St=ts.create(lr,{...Pt.none.slider,connect:"lower"});ve.hidden=!0;xe==null||xe.addEventListener("change",()=>{const t=x.effect.value;ve.hidden=t==="none",St.updateOptions(Pt[t].slider,!1)});St.on("update",()=>{const t=St.get();x["effect-level"].value=String(t);const e=x.effect.value;if(e==="none")return ue.style.removeProperty("filter");const s=Pt[e].filter;ue.style.filter=s(t)});const ns=()=>{x.effect.value="none",xe.dispatchEvent(rs)},ss={IDLE:"Опубликовать",SENDING:"Публикую..."},Kt=(t="IDLE")=>{pt.disabled=t==="SENDING",pt.textContent=ss[t]},is=["png","jpeg","jpg"],as=x.querySelectorAll(".effects__preview"),os=t=>{const e=t.name.toLowerCase();return is.some(s=>e.endsWith(s))},ls=t=>{ue.src=URL.createObjectURL(t),as.forEach(e=>{e.style.backgroundImage=`url(${ue.src})`})},cs=()=>{const t=x.filename.files;if(t===null||t.length===0)return!1;const e=t[0];return os(e)?(ls(e),!0):!1},gr=()=>x.reset(),Sr=t=>{const e=document.activeElement===x.hashtags||document.activeElement===x.description;Et(t)&&!e&&gr()};x.filename.addEventListener("change",()=>{if(!cs())return bt.open({title:"Ошибка загрузки"});Ge(Ct),document.addEventListener("keydown",Sr)});x.addEventListener("reset",()=>{Ge(Ct,!1),pn(),on(),ns(),document.removeEventListener("keydown",Sr)});x.addEventListener("submit",async t=>{if(t.preventDefault(),mn()){Kt("SENDING");try{await Xt.sendPhoto(new FormData(x)),gr(),Fr.open()}catch{bt.open()}Kt("IDLE")}});
